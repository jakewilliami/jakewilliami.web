<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://jakewilliami.github.io/main.css">
  <title>Jake W. Ireland&#x27;s Blog</title>
  <meta name="description" itemprop="about" content="Blog for J. W. Ireland; computer programmer, psychologist, and mathematician">

  
  <link rel="icon" type="image/x-icon" href="https://jakewilliami.github.io/assets/icons/favicon-dark.ico">
  <link rel="apple-touch-icon" href="https://jakewilliami.github.io/assets/icons/apple-touch-icon-dark.png">
  

  
  <link type="application/atom+xml" rel="alternate"
    href="https://jakewilliami.github.io/atom.xml"
    title="Jake W. Ireland&#x27;s Blog" />
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bitter:400,700&display=swap" />

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js" integrity="sha384-hIoBPJpTUs74ddyc4bFZSM1TVlQDA60VBbJS0oA934VSz82sBx1X7kSx2ATBDIyd" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>


</head>


<body>
  <section class='darkmode'>
  <input class='toggle' id='darkmode-toggle' type='checkbox' tabindex="-1">
  <label id="toggle-label-dark" for='darkmode-toggle' tabindex="-1">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon"
      x="0px" y="0px" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'" xml:space="preserve">
      <title>Change to dark mode</title>
      <path
        d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z" />
    </svg>
  </label>
  <label id="toggle-label-light" for='darkmode-toggle' tabindex="-1">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon"
      x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35;" xml:space="preserve">
      <title>Change to light mode</title>
      <path
        d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z" />
    </svg>
  </label>
</section>

<style>
  .darkmode {
    display: inline-block;

    &>.toggle {
      display: none;
      box-sizing: border-box;
    }

    & svg {
      opacity: 0;
      width: 20px;
      height: 20px;
      fill: var(--gray);
      transition: opacity 0.1s ease;
      cursor: pointer;
    }

    .toggle:checked~label {
      &>#dayIcon {
        opacity: 0;
        display: none;
      }

      &>#nightIcon {
        opacity: 1;
        filter: invert(1);
      }
    }

    .toggle:not(:checked)~label {
      &>#dayIcon {
        opacity: 1;
      }

      &>#nightIcon {
        opacity: 0;
        display: none;
      }
    }
</style>

<script>
  const userPref = window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark'
  const currentTheme = localStorage.getItem('theme') ?? userPref
  const syntaxTheme = document.querySelector("#theme-link");

  if (currentTheme) {
    document.documentElement.setAttribute('saved-theme', currentTheme);
  }

  const switchTheme = (e) => {
    if (e.target.checked) {
      document.documentElement.setAttribute('saved-theme', 'dark');
      localStorage.setItem('theme', 'dark');
    }
    else {
      document.documentElement.setAttribute('saved-theme', 'light')
      localStorage.setItem('theme', 'light')
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    // Darkmode toggle
    const toggleSwitch = document.querySelector('#darkmode-toggle')

    // listen for toggle
    toggleSwitch.addEventListener('change', switchTheme, false)

    if (currentTheme === 'dark') {
      toggleSwitch.checked = true
    }
  })

</script>


<nav class="nav">
  <section class="nav-container">

    <a href="https://jakewilliami.github.io/">
      <h2 class="nav-title">Jake W. Ireland&#x27;s Blog</h2>
    </a>
    <ul>
      
      
      <li><a href="https://jakewilliami.github.io/about">About</a></li>
      
    </ul>
  </section>
</nav>


  <main>
    
<article class="post">
	<section class="post-info">
		
		<span>on&nbsp;</span><time datetime="2021-03-28">Sunday, 28 March, 2021</time>
	</section>
	<h1 class="post-title">
      Perfect Power Checker in Julia
    </h1>
	<section class="post-line"></section>
	<p>A perfect power is an integer \(m\) whose \(n^\text{th}\) root is an integer \(a\).  That is,&mdash;</p>
$$
  m = a^n
$$
<p>For a very long time, intermittently, I have been trying to write an efficient function to check if a number is a perfect power or not.  It's been about 5 months now actually, and I can't remember why.  All I recall is that I wanted to know specifically if a number was a perfect power or not—not necessarily what numbers combine to produce the given number.</p>
<p>I think I came across the issue when doing coding theory.  There is no known perfect codes for alphabet size of non-perfect-powers.  And I was wondering if there is a good programmatic solution to this.</p>
<p>Well, the naïve solution is to check every combination:</p>
<pre data-lang="julia" style="background-color:#282a36;color:#f8f8f2;" class="language-julia "><code class="language-julia" data-lang="julia"><span style="color:#ff79c6;">for</span><span> a </span><span style="color:#ff79c6;">in </span><span style="color:#bd93f9;">1</span><span style="color:#ff79c6;">:</span><span>m
</span><span>	</span><span style="color:#ff79c6;">for</span><span> n </span><span style="color:#ff79c6;">in </span><span style="color:#bd93f9;">1</span><span style="color:#ff79c6;">:</span><span>m
</span><span>		a</span><span style="color:#ff79c6;">^</span><span>n </span><span style="color:#ff79c6;">==</span><span> m </span><span style="color:#ff79c6;">&amp;&amp; return </span><span style="color:#bd93f9;">true
</span><span>	</span><span style="color:#ff79c6;">end
</span><span style="color:#ff79c6;">end
</span><span>
</span><span style="color:#ff79c6;">return </span><span style="color:#bd93f9;">false
</span></code></pre>
<p>But this is very slow.  In fact, fast <em>enough</em> for 8-bit integers, but extremely slow for anything more.</p>
<p>After some searching, I found a 1997 article by Daniel J. Bernstein titled <a href="https://cr.yp.to/papers/powers.pdf">&quot;Detecting Perfect Powers in Essentially Linear Time&quot;</a>.  After days of trying to translate this into Julia, I realised that he had used his own floating point number representation that he heavily relied on in his logic...  This is something I don't want to have to do: reinvent the <strike>wheel</strike> <code>Float</code>.  He also used a <code>divrem</code> method that required some some steps digit-by-digits, designed by Knuth:
<img src="https://jakewilliami.github.io/perfect-powers/./assets/MIX.png" alt="MIX" />
My port into Julia is certainly not the fastest solution.  I figured that anything I wrote would likely not be as theoretically efficient as in the paper.</p>
<p>So I contacted Mr. Bernstein asking for advice.  He got back to me referencing another paper—an updated version of the former—which he also wrote, in 2004, titled <a href="https://cr.yp.to/lineartime/powers2-20060914-ams.pdf">&quot;Factoring into coprimes in essentially linear time&quot;</a>.  I started workin on this one in Julia too, but was stuck at the first step...in which he uses the previous paper to generate a list of prime powers (which, let's not forget, are <i>themselves</i> perfect powers)...  Beginning to feel very circular!</p>
<p>I put this project on the back burner while I wrapped up my exploratory work with Dillon Mayhew, but just this evening it has found me again.  I was looking through my GitHub stars, and I found <a href="https://github.com/OpenLibMathSeq/IntegerSequences.jl">IntegerSequences.jl</a>, which looks to be largely written by one Peter Luschny.  I looked through the code because I was curious, and found an <code>isPrimePower</code> function!  Looking deeper, I extracted the bits I needed, and modified/optimised the code a little, and came up with the following:</p>
<pre data-lang="julia" style="background-color:#282a36;color:#f8f8f2;" class="language-julia "><code class="language-julia" data-lang="julia"><span style="color:#ff79c6;">using</span><span> Nemo</span><span style="color:#ff79c6;">:</span><span> isprime, factor, fmpz
</span><span>
</span><span style="color:#ff79c6;">function </span><span style="color:#50fa7b;">__isprime</span><span>(n)
</span><span>	</span><span style="color:#ff79c6;">return</span><span> isprime(fmpz(n))
</span><span style="color:#ff79c6;">end
</span><span>
</span><span style="color:#ff79c6;">function </span><span style="color:#50fa7b;">__factors</span><span>(n)
</span><span>	</span><span style="color:#ff79c6;">return</span><span> n </span><span style="color:#ff79c6;">== </span><span style="color:#bd93f9;">0 </span><span style="color:#ff79c6;">? </span><span>[] </span><span style="color:#ff79c6;">: </span><span>factor(fmpz(n))
</span><span style="color:#ff79c6;">end
</span><span>
</span><span style="color:#ff79c6;">function </span><span style="color:#50fa7b;">ω</span><span>(n)
</span><span>	nprimedivisors </span><span style="color:#ff79c6;">= </span><span style="color:#bd93f9;">nothing
</span><span>	</span><span style="color:#ff79c6;">if</span><span> n </span><span style="color:#ff79c6;">== </span><span style="color:#bd93f9;">0
</span><span>		nprimedivisors </span><span style="color:#ff79c6;">= </span><span style="color:#bd93f9;">0
</span><span>	</span><span style="color:#ff79c6;">elseif</span><span> __isprime(n)
</span><span>		nprimedivisors </span><span style="color:#ff79c6;">= </span><span style="color:#bd93f9;">1
</span><span>    </span><span style="color:#ff79c6;">else
</span><span>        nprimedivisors </span><span style="color:#ff79c6;">=</span><span> length(__factors(n))
</span><span>	</span><span style="color:#ff79c6;">end
</span><span>
</span><span>	</span><span style="color:#ff79c6;">return</span><span> fmpz(nprimedivisors)
</span><span style="color:#ff79c6;">end
</span><span>
</span><span style="color:#ff79c6;">function </span><span style="color:#50fa7b;">Ω</span><span>(n)
</span><span>    n </span><span style="color:#ff79c6;">==</span><span> fmpz(</span><span style="color:#bd93f9;">0</span><span>) </span><span style="color:#ff79c6;">&amp;&amp; return </span><span style="color:#bd93f9;">0
</span><span>    __isprime(n) </span><span style="color:#ff79c6;">&amp;&amp; return</span><span> fmpz(</span><span style="color:#bd93f9;">1</span><span>)
</span><span>
</span><span>    </span><span style="color:#ff79c6;">return</span><span> sum(e </span><span style="color:#ff79c6;">for </span><span>(__, e) </span><span style="color:#ff79c6;">∈</span><span> __factors(n))
</span><span style="color:#ff79c6;">end
</span><span>
</span><span style="color:#ff79c6;">function </span><span style="color:#50fa7b;">isperfectpower</span><span>(n)
</span><span>	</span><span style="color:#ff79c6;">return</span><span> ω(n) </span><span style="color:#ff79c6;">== </span><span style="color:#bd93f9;">1 </span><span style="color:#ff79c6;">&amp;&amp;</span><span> Ω(n) </span><span style="color:#ff79c6;">!= </span><span style="color:#bd93f9;">1
</span><span style="color:#ff79c6;">end
</span></code></pre>
<p>This is actually blazingly fast.  I did some benchmarking, and I will put the results here.  Unfortunately the only comparisons we can realistically make (as I don't have all night) are ones on small integers, as larger integers simply scale too much for the brute force method.</p>
<table><thead><tr><th>Perfect Power Implementation</th><th>List Type</th><th>List Size</th><th>Run Time</th><th>Number of Allocations</th><th>Memory Usage</th></tr></thead><tbody>
<tr><td>Brute force (<code>bf</code>)</td><td><code>Int8</code></td><td>100</td><td>1.358 ms</td><td>11</td><td>2.11 KiB</td></tr>
<tr><td>Clever (<code>c</code>)</td><td><code>Int8</code></td><td>100</td><td>122.749 μs</td><td>2,927</td><td>170.95 KiB</td></tr>
<tr><td><code>bf</code></td><td><code>Int8</code></td><td>1,000</td><td>16.382 ms</td><td>10</td><td>32.66 KiB</td></tr>
<tr><td><code>c</code></td><td><code>Int8</code></td><td>1,000</td><td>1.235 ms</td><td>28,877</td><td>1.62 MiB</td></tr>
<tr><td><code>bf</code></td><td><code>Int8</code></td><td>10,000</td><td>179.624 ms</td><td>12</td><td>166.48 KiB</td></tr>
<tr><td><code>c</code></td><td><code>Int8</code></td><td>10,000</td><td>12.616 ms</td><td>286,870</td><td>16.25 MiB</td></tr>
<tr><td><code>bf</code></td><td><code>Int8</code></td><td>1,000,000</td><td>17.701 s</td><td>12</td><td>16.21 MiB</td></tr>
<tr><td><code>c</code></td><td><code>Int8</code></td><td>1,000,000</td><td>3.141 s</td><td>28,784,244</td><td>1.59 GiB</td></tr>
<tr><td><code>c</code></td><td><code>Int16</code></td><td>100</td><td>23.333 μs</td><td>2,551</td><td>153.39 KiB</td></tr>
<tr><td><code>c</code></td><td><code>Int32</code></td><td>100</td><td>650.484 μs</td><td>2,347</td><td>152.25 KiB</td></tr>
<tr><td><code>c</code></td><td><code>Int64</code></td><td>100</td><td>13.342 ms</td><td>2,044</td><td>1.30 MiB</td></tr>
<tr><td><code>c</code></td><td><code>Int128</code></td><td>100</td><td>4.182 s</td><td>5,547,237</td><td>960.02 MiB</td></tr>
<tr><td><code>c</code></td><td><code>Int128</code></td><td>1,000</td><td>40.835 s</td><td>51,785,224</td><td>8.46 GiB</td></tr>
<tr><td><code>c</code></td><td><code>Int128</code></td><td>10,000</td><td>669.043 s</td><td>532,334,303</td><td>89.17 GiB</td></tr>
</tbody></table>
<hr />
<p>Going a bit deeper into why this method works so seemingly efficiently, we need to</p>

</article>

<section class="pagination">
	<a href="https://jakewilliami.github.io/htb-archetype/" class="left arrow">&#8592;</a>
	<a href="#" class="top">Top</a>
	<a href="https://jakewilliami.github.io/htb-ready/" class="right arrow">&#8594;</a>
</section>

  </main>

  <footer>

  <span class="copyright">
    &copy; 2020&ndash;2024 Jake W. Ireland. Powered by <a href="https://www.getzola.org">Zola</a> and <a href="https://github.com/semanticdata/mabuya">Mabuya</a>/<a href="https://github.com/aaranxu/tale-zola">Tale</a>; inspired by <a href="https://github.com/nielsenramon/chalk">Chalk</a>.
  </span>

  <nav class="navigation-footer">
    <ul>
      <li><a href="https://github.com/jakewilliami">GitHub</a></li>
      <li><a href="https://twitter.com/JakeWIreland">Twitter</a></li>
      <li><a href="https://www.linkedin.com/in/jake-ireland-nz/">LinkedIn</a></li>
    </ul>
  </nav>

</footer>

</body>

</html>